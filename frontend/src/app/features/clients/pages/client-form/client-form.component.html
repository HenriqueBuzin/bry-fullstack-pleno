<div class="container mt-4">

  <div class="d-flex align-items-center mb-3">
    <button class="btn btn-secondary me-3" (click)="voltar()">← Voltar</button>
    <h2 class="mb-0">
      {{ clientId ? 'Editar Cliente' : 'Novo Cliente' }}
    </h2>
  </div>

  <!-- ✅ Alerts Bootstrap -->
  <div *ngIf="successMessage" class="alert alert-success" role="alert">
    {{ successMessage }}
  </div>

  <div *ngIf="errorMessage" class="alert alert-danger" role="alert">
    {{ errorMessage }}
  </div>

  <form [formGroup]="form" (ngSubmit)="salvar()" novalidate>

    <!-- Login -->
    <div class="mb-3">
      <label class="form-label">Login *</label>
      <input class="form-control"
             formControlName="login"
             [class.is-invalid]="campoInvalido('login')">
      <div class="invalid-feedback">
        Login obrigatório e sem acentos
      </div>
    </div>

    <!-- Nome -->
    <div class="mb-3">
      <label class="form-label">Nome *</label>
      <input class="form-control"
             formControlName="name"
             [class.is-invalid]="campoInvalido('name')">
      <div class="invalid-feedback">
        Nome inválido ou com acentos
      </div>
    </div>

    <!-- CPF -->
    <div class="mb-3">
      <label class="form-label">CPF *</label>
      <input class="form-control"
             formControlName="cpf"
             maxlength="14"
             (input)="onCpfInput($event)"
             placeholder="000.000.000-00"
             [class.is-invalid]="campoInvalido('cpf')">
      <div class="invalid-feedback">
        CPF inválido
      </div>
    </div>

    <!-- Email -->
    <div class="mb-3">
      <label class="form-label">E-mail *</label>
      <input class="form-control"
             formControlName="email"
             [class.is-invalid]="campoInvalido('email')">
      <div class="invalid-feedback">
        Informe um e-mail válido (ex: nome&#64;email.com)
      </div>
    </div>

    <!-- Endereço -->
    <div class="mb-3">
      <label class="form-label">Endereço *</label>
      <input class="form-control"
             formControlName="address"
             [class.is-invalid]="campoInvalido('address')">
      <div class="invalid-feedback">
        Endereço obrigatório
      </div>
    </div>

    <!-- Senha (somente create) -->
    <div class="mb-3" *ngIf="!clientId">
      <label class="form-label">Senha *</label>
      <input type="password"
             class="form-control"
             formControlName="password"
             [class.is-invalid]="campoInvalido('password')">
      <div class="invalid-feedback">
        Mínimo de 6 caracteres
      </div>
    </div>

    <!-- ✅ Documento (PDF/JPG) -->
    <div class="mb-3">
      <label class="form-label">Documento (PDF ou JPG)</label>
      <input type="file"
             class="form-control"
             accept=".pdf,.jpg,.jpeg,application/pdf,image/jpeg"
             (change)="onDocumentSelected($event)">
      <div class="form-text">
        Envie um arquivo PDF ou JPG.
      </div>
    </div>

    <!-- Empresas -->
    <div class="mb-3">
      <label class="form-label">Empresas</label>

      <div *ngFor="let c of companies" class="form-check">
        <input class="form-check-input"
               type="checkbox"
               [id]="'company-' + c.id"
               [checked]="form.controls.company_ids.value.includes(c.id!)"
               (change)="onCompanyToggle(c.id!)">

        <label class="form-check-label"
               [for]="'company-' + c.id"
               style="cursor: pointer">
          {{ c.name }}
        </label>
      </div>
    </div>

    <button class="btn btn-primary" type="submit" [disabled]="loading">
      {{ loading ? 'Salvando...' : 'Salvar' }}
    </button>

  </form>
</div>
