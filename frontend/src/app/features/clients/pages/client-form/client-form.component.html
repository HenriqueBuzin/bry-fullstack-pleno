<div class="container mt-4">

  <div class="d-flex align-items-center mb-3 justify-content-between">

    <button class="btn btn-secondary" title="Voltar" (click)="voltar()">
      ← Voltar
    </button>

    <h2 class="mb-0">
      {{ clientId ? 'Editar Cliente' : 'Novo Cliente' }}
    </h2>

    <div></div>

  </div>


  <div *ngIf="successMessage" class="alert alert-success alert-dismissible fade show">
    {{ successMessage }}
    <button class="btn-close" (click)="successMessage = undefined"></button>
  </div>

  <div *ngIf="warningMessages.length" class="alert alert-warning alert-dismissible fade show">
    <ul class="mb-0">
      <li *ngFor="let msg of warningMessages">{{ msg }}</li>
    </ul>
    <button class="btn-close" (click)="warningMessages = []"></button>
  </div>

  <div *ngIf="errorMessages.length" class="alert alert-danger alert-dismissible fade show">
    <ul class="mb-0">
      <li *ngFor="let msg of errorMessages">{{ msg }}</li>
    </ul>
    <button class="btn-close" (click)="errorMessages = []"></button>
  </div>

  <div class="mb-3">
    <small>Os campos com * ao lado do nome são obrigatórios</small>
  </div>

  <form [formGroup]="form" (ngSubmit)="salvar()" novalidate>

    <div class="mb-3">
      <label class="form-label">Login *</label>
      <input class="form-control" formControlName="login" [class.is-invalid]="campoInvalido('login')">
      <div class="invalid-feedback">
        Login obrigatório e sem acentos.
      </div>
    </div>

    <div class="mb-3">
      <label class="form-label">Nome *</label>
      <input class="form-control" formControlName="name" [class.is-invalid]="campoInvalido('name')">
      <div class="invalid-feedback">
        Nome inválido ou com acentos.
      </div>
    </div>

    <div class="mb-3">
      <label class="form-label">CPF *</label>
      <input class="form-control" formControlName="cpf" maxlength="14" placeholder="000.000.000-00"
        (input)="onCpfInput($event)" [class.is-invalid]="campoInvalido('cpf')">
      <div class="invalid-feedback">
        CPF inválido.
      </div>
    </div>

    <div class="mb-3">
      <label class="form-label">E-mail *</label>
      <input class="form-control" formControlName="email" [class.is-invalid]="campoInvalido('email')">
      <div class="invalid-feedback">
        Informe um e-mail válido.
      </div>
    </div>

    <div class="mb-3">
      <label class="form-label">Endereço *</label>
      <input class="form-control" formControlName="address" [class.is-invalid]="campoInvalido('address')">
      <div class="invalid-feedback">
        Endereço obrigatório.
      </div>
    </div>

    <div class="mb-3">
      <label class="form-label">
        Senha {{ clientId ? '(opcional)' : '*' }}
      </label>

      <input type="password" class="form-control" formControlName="password"
        [class.is-invalid]="campoInvalido('password')">

      <div class="invalid-feedback" *ngIf="campoInvalido('password')">
        <div *ngIf="form.get('password')?.errors?.['minlength']">
          A senha deve ter no mínimo 6 caracteres.
        </div>
      </div>
    </div>

    <div class="mb-3">
      <label class="form-label">Empresas</label>

      <div *ngFor="let c of companies" class="form-check">
        <input class="form-check-input" type="checkbox" [id]="'company-' + c.id"
          [checked]="form.controls.company_ids.value.includes(c.id!)" (change)="onCompanyToggle(c.id!)">
        <label class="form-check-label" [for]="'company-' + c.id">
          {{ c.name }}
        </label>
      </div>
    </div>

    <div class="mb-3">
      <label class="form-label">Documento (PDF ou JPG)</label>
      <input type="file" class="form-control" accept=".pdf,.jpg,.jpeg,application/pdf,image/jpeg"
        (change)="onDocumentSelected($event)">
    </div>

    <button class="btn btn-primary" type="submit" [disabled]="loading">
      {{ loading
      ? 'Salvando...'
      : (clientId ? 'Salvar Alterações' : 'Cadastrar')
      }}
    </button>

  </form>
</div>